---
title: 倍增分块

mathjax: true

tags: 

- 学习笔记
- 倍增分块

categories: 学习笔记

excerpt: 倍增分块学习笔记和练习记录。
---

倍增分块实际上是一种对于值域的不均匀分块，它将 $[2^k, 2^{k+1})$ 划分为一块，从而加快计算。

[CF702F - T-Shirts](https://codeforces.com/problemset/problem/702/F) *2800

这是一个倍增分块最简单的应用。

定义：$w$ 表示物品的重量，$v$ 表示价值。

题目中有一个明显的提示：每次买能买的物品中价值最大的一个。

将物品按照价值降序排序后，等价于给定一个 $c$，扫描这个序列 $a$，若 $c \ge a_i$，则 $c \leftarrow c - a_i$。

考虑将物品的**重量**进行分块，设 $c \in [2^\omega, 2^{\omega+1})$，称 $c$ 属于第 $\omega$ 块内。

然后考虑如何能使得 $c$ 降级成为第 $\omega - 1$ 块，为了方便叙述，假设重量 $w \in [2^\omega, 2^{\omega+1})$ 的物品为**重物品**，否则为**轻物品**（大于当前块的不加考虑），那么情况无非如下几种：

- 选择了一个重物品，因为其二进制下最高位是相同的。
- 选择若干个轻物品，然后选择了一个重物品。
- 选择若干轻物品。

因此尝试用线段树维护这种情况，记住目的是快速的使得 $c$ 降级到更低的块。

对于每个线段树上的节点，维护一个 $\mathrm{sumw_i}$ 表示这个节点中 $w < 2^i$ 的物品的重量和，再维护一个 $\mathrm{need_i}$ 表示要取走一个第 $i$ 块的物品（也就是 $w \in [2^i, 2^{i+1})$ 的物品）至少需要多大的容量。

假设现在递归到了线段树上的某个节点，若当前的 $c$ 能取走所有物品（包括重物品和轻物品），那么直接取走，返回即可。

如果能取走所有的轻物品，但是一个重物品都不能取走，那么也是直接返回。

剩下的情况，分别计算左右儿子的答案。

这样的时间复杂度是正确的，因为每次递归下去必然是轻物品都取不完或者是能取到重物品，也就是 $c$ 一定降级，这样的降级至多 $\log V$ 次，因此总复杂度为单次 $\mathcal{O}(\log n\log V)$。

[参考代码。](https://codeforces.com/contest/702/submission/281122430)

[CF1515I - Phoenix and Diamonds](https://codeforces.com/problemset/problem/1515/I) *3400

上一题的带修改版本，使用倍增分块就没有本质区别。

[P7447 [Ynoi2007] rgxsxrs](https://www.luogu.com.cn/problem/P7447)

直接按照势能的做法是错误的，考虑倍增分块。

建立 $\mathcal{O}(\log V)$ 个线段树，每个线段树上维护题目中要求的三个信息。

对于操作一，在线段树上的某个节点，若最大值小于等于 $x$ 直接返回，否则若最小值减去 $x$ 仍然在块内，则打标记返回。

否则递归下去，势必存在一个点会降级到下一个块内，时间复杂度 $\mathcal{O}(n \log n \log V)$，空间复杂度 $\mathcal{O}(n \log V)$。

本题空间限制为 64MB，所以需要线性空间，对此的解决办法是底层分块，不做过多展开，简单来说就是对于线段树上区间长度小于 $B$ 的点不向下递归，而是暴力做。



